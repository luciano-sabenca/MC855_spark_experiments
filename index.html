<html>
<head>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
	<div id="myDiv"></div>
	<script>
	Plotly.d3.csv('https://raw.githubusercontent.com/luciano-sabenca/MC855_spark_experiments/master/optimized_localization/part-00000', function (err, rows) {
		var cityName = [],
			cityLat = [],
			cityLon = [],
			color = [,"rgb(255,65,54)","rgb(133,20,75)","rgb(255,133,27)","lightgrey"],
			citySize = [],
			hoverText = [],
			scale = 20;

		for (var i = 0; i < rows.length; i++) {
			var index = cityName.indexOf(rows[i]['name']);
			if (index == -1) {
				cityName.push(rows[i]['name']);
				cityLat.push(rows[i]['lat']);
				cityLon.push(rows[i]['long']);
				citySize.push(1/scale);
				hoverText.push(rows[i]['name'] + "<br>IPs: " + 1);
			} else {
				citySize[index] = citySize[index] + 1/scale;
				hoverText.push(rows[i]['name'] + "<br>IPs: " + citySize[index]);
			}
		}
		console.info(rows[0]);

		var data = [{
			type: 'scattergeo',
			locationmode: 'world',
			lat: cityLat,
			lon: cityLon,
			text: hoverText,
			hoverinfo: 'text',
			marker: {
				size: citySize,
				line: {
			 		color: 'black',
			 		width: 2
		 		},
		 	}
		}];

		var layout = {
			showlegend: false,
			width: 1000,
			height: 800,
			geo: {
				scope: 'world',
				resolution: 50,
				showland: true,
				landcolor: 'rgb(217, 217, 217)',
				subunitwidth: 0,
				countrywidth: 1,
				subunitcolor: 'rgb(255,255,255)',
				countrycolor: 'rgb(255,255,255)'
			},
		};

		Plotly.plot(myDiv, data, layout, {showLink: false});
	});
	</script>
</body>
